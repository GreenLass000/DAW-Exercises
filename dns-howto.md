# DNS

## Instalación 

Lo primero que hay que hacer siempre es actualizar las dependencias

```bash
apt update
```

Instala dns `bind9` y programas extras `dnsutils`

```bash
apt install bind9 dnsutils
```

Para comprobar la sintaxis de los archivos de configuración de bind9

```bash
# Puedes especificar un archivo que quieras comprobar
named-checkconf [fichero]
# Si se pone vacío compruena named.conf junto a sus imports
named-checkconf
```

Cambiar `/etc/resolv.conf` 
```
nameserver 127.0.0.1
```

Escribir el siguiente comando para que al reiniciar no se sobreescriba
```bash
chattr +i /etc/resolv.conf
```
Para poder editar el archivo hay que desbloquearlo
```bash
chattr -i /etc/resolv.conf
```

## Configuración

Configurar los forwarders para añadir la ip en el archivo `/etc/bind/named.conf.options`
Hay que añadir la línea `auth-nxdomain no`
```
options {
        directory "/var/cache/bind";

        // If there is a firewall between you and nameservers you want
        // to talk to, you may need to fix the firewall to allow multiple
        // ports to talk.  See http://www.kb.cert.org/vuls/id/800113

        // If your ISP provided one or more IP addresses for stable
        // nameservers, you probably want to use them as forwarders.
        // Uncomment the following block, and insert the addresses replacing
        // the all-0's placeholder.

        forwarders {
                127.0.1.1;
        //      1.1.1.1;
        //      8.8.8.8;
        };

        //========================================================================
        // If BIND logs error messages about the root key being expired,
        // you will need to update your keys.  See https://www.isc.org/bind-keys
        //========================================================================

        //dnssec-validation auto;

        auth-nxdomain no;
        listen-on-v6 { any; };
};
```
Añadir el dominio al resolv en `/etc/resolv.conf`
```
search [dominio]
domain [dominio]
nameserver 127.0.0.1
```

Configurar la zona directa en el archivo `/etc/bind/named.conf.local`
```
//
// Do any local configuration here
//

// Consider adding the 1918 zones here, if they are not used in your 
// organization
//include "/etc/bind/zones.rfc1918";

zone "a01.com" { 
        type master;
        file "/etc/bind/db.a01.com";
        allow-query { any; };
};
```

Y crear archivo de zona directa `/etc/bind/db.[nombre]`
```
;
; archivo BIND para zona [name]
;

$TTL    604800
@       IN      SOA     [name].        hostmaster.[name].    (
                1               ; Serial
                86400           ; Refresh
                7200            ; Retry
                1209600         ; Expire
                10800 )         ; Negative Cache TTL

[name].         IN      NS      ns1.a01.com.
[name].         IN      MX      1        ns1.a01.com.
[name].         IN      A       27.0.175.226
ns1             IN      A       27.0.175.226
www             IN      A       127.0.0.1
#smtp           IN      A       127.0.0.1

status          IN      CNAME   [ddns hostname].
```

## DDNS

Para configurar un ddns hay que instalar el cliente de un servicio ddns

```bash
apt install ddclient
```
Seguir todos los pasos que aparecen en pantalla

Se puede cambiar la configuración desde `/etc/ddclient.conf`
```
# Configuration file for ddclient generated by debconf
#
# /etc/ddclient.conf

protocol=noip \
use=web, web=http://ip1.dynupdate.no-ip.com/ \
login=[usuario] \
password=[contraseña] \
[ddns hostname]
```

<!--stackedit_data:
eyJoaXN0b3J5IjpbNzQ4ODYwMDcsMTU0NjUyMzE5NCwtMjE0Nz
IzMjczMSwtMjEwMTEyNDY5MywxODkyNDIwNDg1LC0zODgzMzA0
OTUsMTI0MTUxNDMwOCwtMTAwMjU0MzU2Nl19
-->